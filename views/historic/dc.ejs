<%- include ../partials/header.ejs %>
  <body>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/1.7.5/dc.css"/>

    <div id="graphdiv"></div>
    <div id="legenddiv"></div>
    <div id="chart-line-hitsperday"></div>
    <div id="monthly-move-chart"></div>
    <script type="text/javascript">
        // var data = [
        //     {date: "12/27/2012", http_404: 2, http_200: 190, http_302: 100},
        //     {date: "01/07/2013", http_404: 1, http_200: 200, http_302: 100}
        // ];
        $.getJSON("fatcat", function( data ) {
          console.log(data);
        });
        $.getJSON("data?from=2018-05-09&to=2018-05-10", function( data ) {
          console.log(data);
          // var data = [
          //     {date: "12/27/2012", http_404: 2, http_200: 190, http_302: 100},
          //     {date: "01/07/2013", http_404: 1, http_200: 200, http_302: 100}
          // ];
          var instance = crossfilter(data);

          data.forEach(function(d) {
              d.date = Date.parse(d.timestamp);
              // d.total = d.max_temp;
          });

          console.log(data);
          //
          // print_filter("data");

          var dateDim = instance.dimension(function(d) { return d.date; });
          var temp = dateDim.group().reduceSum(function(d) { return d.max_temp; });
          var minDate = dateDim.bottom(1)[0].date;
          var maxDate = dateDim.top(1)[0].date;
          var hitslineChart = dc.lineChart("#chart-line-hitsperday");  // reference error number 1 is here.
          var moveChart = dc.lineChart('#monthly-move-chart');

          moveChart /* dc.lineChart('#monthly-move-chart', 'chartGroup') */
            .renderArea(true)
            .width(990)
            .height(200)
            .group(temp)
            .transitionDuration(1000)
            .margins({top: 30, right: 50, bottom: 25, left: 40})
            .dimension(dateDim)
            .mouseZoomable(true)
            .elasticY(true)
            .renderHorizontalGridLines(true)
            .x(d3.time.scale().domain([minDate,maxDate]));

          hitslineChart
              .width(500).height(200)
              .dimension(dateDim)
              .group(temp)
              .x(d3.time.scale().domain([minDate,maxDate]));

          dc.renderAll();
          //
          // function print_filter(filter){
          //     var f=eval(filter);
          //     if (typeof(f.length) != "undefined") {}else{}
          //     if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
          //     if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
          //     console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
          // }
        });



    </script>
  </body>
</html>
